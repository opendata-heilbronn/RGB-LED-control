<html>
<head>
    <style>

        .raum {
            stroke: #FF0000;
            stroke-width: 7px;
        }

        .online {
            stroke: #00FF00 !important;
        }

        .offline {
            stroke: #FF0000 !important;
        }

        .raum:hover {
            fill: red !important;
        }

        .aussenwand {
            fill: none;
            stroke: #B37D51;
            stroke-width: 16px;
        }

        .innenwand {
            fill: none;
            stroke: #0002ff;
            stroke-width: 7px;
        }

    </style>

    <script src="https://code.jquery.com/jquery-3.1.1.min.js" type="application/javascript"></script>
    <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
</head>
<body>
<svg width="100%" height="90%" viewBox="0 0 1292 1253" version="1.1"
     xmlns="http://www.w3.org/2000/svg"  xml:space="preserve"
     style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">

<path d="M663.544,649.154l-0.006,515.752" class="aussenwand"/>
<path d="M565.809,68.637l79.119,0" class="aussenwand"/>
<path d="M87.458,528.318l0,79.119" class="aussenwand"/>
<path d="M8.419,68.637l79.039,-60.369" class="aussenwand"/>
<path d="M565.809,68.637l-79.039,-60.369" class="aussenwand"/>
<path d="M87.458,528.318l-79.039,-60.37" class="aussenwand"/>
<path d="M8.419,68.637l0,399.311" class="aussenwand"/>
<path d="M87.458,8.268l399.312,0" class="aussenwand"/>
<path d="M87.922,686.555l0,-79.118" class="aussenwand"/>
<path d="M87.922,1243.95l-79.672,-78.161" class="aussenwand"/>
<path d="M87.922,686.555l-79.672,81.288" class="aussenwand"/>
<path d="M663.538,1164.91l-60.369,79.04" class="aussenwand"/>
<path d="M87.922,1243.95l515.247,0" class="aussenwand"/>
<path d="M8.25,1165.79l0,-397.942" class="aussenwand"/>
<path d="M725.936,68.619l-79.119,0" class="aussenwand"/>
<path d="M1283.33,68.619l-79.039,-60.369" class="aussenwand"/>
<path d="M1283.33,583.866l-65.287,65.288l-554.54,0" class="aussenwand"/>
<path d="M725.936,68.619l79.039,-60.369" class="aussenwand"/>
<path d="M1283.33,68.619l0,515.247" class="aussenwand"/>
<path d="M1204.29,8.25l-399.312,0" class="aussenwand"/>
<path d="M1116.31,483.334l-175.284,0" class="innenwand"/>
<path d="M838.939,483.334l0,-90.398l63.464,-63.465" class="innenwand"/>
<path d="M268.913,302.559l424.549,0l54.826,54.826l0,125.949" class="innenwand"/>
<path d="M663.499,302.559l0,105.756" class="innenwand"/>
<path d="M663.499,607.308l0,41.846" class="innenwand"/>
<path d="M748.288,483.334l-84.789,0" class="innenwand"/>
<path d="M663.544,712.231l-153.393,0" class="innenwand"/>

<path id="raum2" class="raum" d="M1283.33,218.66l0,-150.023l-79.039,-60.387l-301.884,0l0,210.41l380.923,0Z" />
<path id="raum3" class="raum" d="M798.239,252.952l32.36,34.108l71.804,-68.4l0,-210.41l-97.428,0l-79.039,60.369l0,167.426l53.274,0l19.029,16.815l0,0.092Z" />
<path id="raum4" class="raum" d="M725.936,68.637l0,167.408l-72.556,0l-50.211,0l-144.909,0l0,-227.777l28.533,0l-0.023,-0.018l79.039,60.387l160.127,0Z" />
<path id="raum5" class="raum" d="M324.154,236.045l0,-227.777l134.106,0l0,227.777l-134.106,0l0,0Z" />
<path id="raum6" class="raum" d="M324.154,8.268l-236.696,0l-79.039,60.369l0,167.408l315.735,0l0,-227.777l0,0Z" />
<path id="raum7" class="raum" d="M8.419,409.659l260.494,0l0,-126.944l0,-46.67l-260.494,0l0,173.614Z" />
<path id="raum12" class="raum" d="M155.421,1005.93l55.353,56.955l0,181.066l-122.852,0l-79.672,-78.161l0,-80.967l67.896,0l79.275,-78.893l0,0Z" />
<path id="raum8" class="raum" d="M663.499,409.679l0,197.629l0.039,0.129l-575.616,0l-0.464,-79.119l-79.039,-60.37l0,-58.269l260.494,-0.02l265.247,-0.904l129.339,0.924Z" />
<path id="raum9" class="raum" d="M8.25,767.843l79.672,-81.288l0,-79.118l287.576,0l0,90.135l-53.635,70.271l-313.613,0Z" />
<path id="raum10" class="raum" d="M8.25,767.843l155.266,0l0,106.938l-155.266,0l0,-106.938Z" />
<path id="raum11" class="raum" d="M163.516,874.781l0,122.336l-87.701,87.701l-67.565,0.22l0,-210.257l155.266,0Z" />
<path id="raum13" class="raum" d="M210.774,1243.95l0,-181.066l238.571,0l0,181.066l-238.571,0l238.571,0l-238.571,0Z" />
<path id="raum14" class="raum" d="M663.544,925.691l-153.445,0l0,77.093l-60.754,60.754l0,180.408l153.824,0l60.375,-79.564l0,-238.691l0,0Z" />
<path id="raum1" class="raum" d="M1283.33,218.66l0,365.206l-64.604,65.288l-41.601,0l0,-165.82l-60.814,0l0,-81.912l-71.951,-71.951l-141.953,0l0,-110.811l380.923,0Z" /></svg>


<script>
    $(function () {

        var roomsCache = null;

        var updateRooms = function(rooms) {
            Object.keys(rooms).forEach(function (key) {
                var device = rooms[key];
                var room = device.room;
                var element = $("#raum" + room);
                element.attr("fill", device.color);
                if (device.isOnline) {
                    element.addClass("online");
                } else {
                    element.addClass("offline");
                }
            });
        };

        $.getJSON("http://192.168.178.168:3000/api/devices").then(function (result) {
            roomsCache = result;
            updateRooms(result);
        });

        const socket = io('http://192.168.178.168:3000/');
        socket.on('connect', function () {
            console.log('connected to socket.io')
        });
        socket.on('devices', function (data) {
            roomsCache = data;
            updateRooms(data);
            console.log('received socket.io devices update', data);
        });
        socket.on('deviceUpdate', function (data) {
            console.log('received socket.io device update', data);
            if (roomsCache) {
                var device = roomsCache[data.mac ? data.mac : data.key];
                $("#raum"+device.room).removeClass("offline").removeClass("online").addClass(data.status);
            }

        });
    });

</script>
</body>

</html>